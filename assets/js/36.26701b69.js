(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{385:function(t,a,s){t.exports=s.p+"assets/img/explorationUpdate-1.5eb88b75.png"},472:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"初探-update-流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初探-update-流程"}},[t._v("#")]),t._v(" 初探 Update 流程")]),t._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("update 流程与 mount 流程的区别")]),t._v(" "),a("p",[t._v("对于 beginWork：")]),t._v(" "),a("ul",[a("li",[t._v("需要处理 ChildDeletion 的情况")]),t._v(" "),a("li",[t._v("需要处理节点移动的情况（abc -> bca）")])]),t._v(" "),a("p",[t._v("对于 completeWork：")]),t._v(" "),a("ul",[a("li",[t._v("需要处理 HostText 内容更新的情况")]),t._v(" "),a("li",[t._v("需要处理 HostComponent 属性变化的情况")])]),t._v(" "),a("p",[t._v("对于 commitWork：")]),t._v(" "),a("ul",[a("li",[t._v("对于 ChildDeletion，需要遍历被删除的子树")]),t._v(" "),a("li",[t._v("对于 Update，需要更新文本内容")])]),t._v(" "),a("p",[t._v("对于 useState：")]),t._v(" "),a("ul",[a("li",[t._v("实现相对于 mountState的updateState")])]),t._v(" "),a("h2",{attrs:{id:"beginwork流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#beginwork流程"}},[t._v("#")]),t._v(" beginWork流程")]),t._v(" "),a("p",[t._v("这里仅处理单一节点，所以省去了「节点移动」的情况。我们需要处理：")]),t._v(" "),a("ul",[a("li",[t._v("singleElement")]),t._v(" "),a("li",[t._v("singleTextNode")])]),t._v(" "),a("p",[t._v("处理流程为：")]),t._v(" "),a("ul",[a("li",[t._v("比较是否可以复用 current fiber"),a("br"),t._v("\na.比较 key，如果 key 不同，不能复用"),a("br"),t._v("\nb.比较 type，如果 type 不同，不能复用"),a("br"),t._v("\nc.如果 key 与 type 都相同，则可复用")]),t._v(" "),a("li",[t._v("不能复用，则创建新的（同mount流程），可以复用则复用旧的")])]),t._v(" "),a("p",[t._v("注意：对于同一个 fiberNode，即使反复更新，current、wip 这两个 fiberNode 会重复使用")]),t._v(" "),a("h2",{attrs:{id:"completework流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#completework流程"}},[t._v("#")]),t._v(" completeWork流程")]),t._v(" "),a("p",[t._v("主要处理"),a("code",[t._v("标记Update")]),t._v("的情况")]),t._v(" "),a("h2",{attrs:{id:"commitwork流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commitwork流程"}},[t._v("#")]),t._v(" commitWork流程")]),t._v(" "),a("p",[t._v("对于标记 ChildDeletion 的子树，由于子树中：")]),t._v(" "),a("ul",[a("li",[t._v("对于 FC，需要处理 useEffect unmout 执行、解绑 ref")]),t._v(" "),a("li",[t._v("对于 HostComponent，需要解绑 ref")]),t._v(" "),a("li",[t._v("对于子树的根 HostComponent，需要移除 DOM")])]),t._v(" "),a("p",[t._v("所以需要实现"),a("code",[t._v("遍历ChildDeletion子树")]),t._v("的流程")]),t._v(" "),a("h2",{attrs:{id:"对于usestate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于usestate"}},[t._v("#")]),t._v(" 对于useState")]),t._v(" "),a("p",[t._v("需要实现：")]),t._v(" "),a("ul",[a("li",[t._v("针对 update 时的 dispatcher")]),t._v(" "),a("li",[t._v("实现对标 mountWorkInProgresHook 的 updateWorkInProgresHook")]),t._v(" "),a("li",[t._v("实现 updateState中"),a("code",[t._v("计算新state的逻辑")])])]),t._v(" "),a("p",[t._v("其中 updateWorkInProgresHook 的实现需要考虑的问题：")]),t._v(" "),a("ul",[a("li",[t._v("hook 数据从哪来？")]),t._v(" "),a("li",[t._v("交互阶段触发的更新")])]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onClick")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ul",[a("li",[t._v("render 阶段触发的更新（TODO）")])]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发更新")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:s(385)}}),t._v(" "),a("SideTitle",{attrs:{page:t.$page}})],1)}),[],!1,null,null,null);a.default=e.exports}}]);